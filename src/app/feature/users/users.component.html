<div class="title-container">
  <a href="/users" class="title-link">
    <svg viewBox="0 0 16 16">
      <use xlink:href="./assets/icons/bootstrap-icons.svg#people-fill" />
    </svg>
    /users
  </a>
</div>

<div class="card shadow m-3">
  <div class="card-body">
    <h5
      class="card-title text-nowrap bg-body-secondary border"
      style="width: 3rem"
    >
      User <b>Management</b>.
    </h5>

    <div class="subtitle">
      <h6 class="users-titleOne">Search by name, email, or application</h6>
    </div>

    <!-- Buscador -->
    <div
      class="input-group mb-3"
      style="
        border: 1px solid var(--sidebar-background-color);
        border-radius: 0.375rem;
        overflow: hidden;
      "
    >
      <input
        type="text"
        class="form-control custom-search-input"
        placeholder="Write some words to filter"
        [(ngModel)]="searchTerm"
        (input)="onSearch()"
      />
      <span
        class="input-group-text"
        style="background-color: transparent; border: none"
      >
        <svg
          fill="currentColor"
          viewBox="0 0 16 16"
          style="
            width: 1rem;
            height: 1rem;
            color: var(--primary_active_text_color);
          "
        >
          <use xlink:href="./assets/icons/bootstrap-icons.svg#search" />
        </svg>
      </span>
    </div>

    <!-- Contador con número de página -->
    <div
      *ngIf="filteredUsers.length > 0"
      class="d-flex justify-content-between align-items-center mb-2 small text-muted"
      style="font-size: 0.875rem; color: var(--sidebar_background_color)"
    >
      <div>
        Mostrando {{ pagedUsers.length }} de {{ filteredUsers.length }} usuarios
      </div>
      <div>Página {{ currentPage }} de {{ totalPages }}</div>
    </div>
    <!-- Mensaje cuando no hay resultados -->
    <div
      *ngIf="filteredUsers.length === 0"
      class="text-center text-danger fw-semibold mt-3"
    >
      No se encontraron resultados para tu búsqueda.
    </div>

    <!-- Tabla de usuarios -->
    <table class="table table-bordered border-secondary table-small small">
    <!-- <table class="table table-bordered table-small small" style="border: 1px solid var(--sidebar-background-color);"> -->
    <!-- <table class="table table-striped table-small small"> -->
      <thead>
        <tr>
          <th class="text-center">Id</th>
          <th class="text-center">User Name</th>
          <th class="text-center">Email</th>
          <th class="text-center">Person Type</th>
          <th class="text-center">Rol</th>
          <th class="text-center">State</th>
          <th class="text-center">Update date</th>
          <th class="text-center">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of pagedUsers">
          <th class="text-center">
            <span
              class="badge"
              style="background-color: var(--header-icon-color)"
            >
              {{ user.id }}
            </span>
          </th>
          <td>{{ user.strUserName }}</td>
          <td>{{ user.strUserName || "-" }}</td>
          <td class="text-center">
            {{
              user.basicData?.strPersonType === "N"
                ? "Natural"
                : user.basicData?.strPersonType === "J"
                ? "Legal"
                : "-"
            }}
          </td>
          <td class="text-center">{{ user.rol?.strName || "-" }}</td>
          <td class="text-center">
            <b
              [ngClass]="{
                'text-danger': user.strStatus?.toUpperCase() === 'INACTIVE',
                'text-success': user.strStatus?.toUpperCase() === 'ACTIVE'
              }"
            >
              <svg fill="currentColor" viewBox="0 0 16 16" class="status-icon">
                <use
                  [attr.xlink:href]="
                    './assets/icons/bootstrap-icons.svg#' +
                    (user.strStatus === 'ACTIVE'
                      ? 'emoji-smile'
                      : 'emoji-frown')
                  "
                ></use>
              </svg>
              {{ user.strStatus }}
            </b>
          </td>
          <td class="text-center">
            {{ user.dtmLatestUpdateDate | date : "dd/MM/yyyy" }}
          </td>
          <td class="text-center">
            <div
              class="btn-group btn-group-sm"
              role="group"
              aria-label="Small button group"
            >
              <a style="color: var(--sidebar-background-color)">
                <svg
                  fill="currentColor"
                  viewBox="0 0 16 16"
                  class="status-icon"
                >
                  <use xlink:href="./assets/icons/bootstrap-icons.svg#eye" />
                </svg>
              </a>
              <a style="color: var(--sidebar-background-color)">
                <svg
                  fill="currentColor"
                  viewBox="0 0 16 16"
                  class="status-icon"
                >
                  <use xlink:href="./assets/icons/bootstrap-icons.svg#pencil" />
                </svg>
              </a>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Paginación personalizada con íconos -->
    <nav
      *ngIf="totalPages > 1"
      class="custom-pagination mt-3 d-flex justify-content-center"
    >
      <ul class="pagination">
        <li class="page-item" [class.disabled]="currentPage === 1">
          <button
            class="page-link d-flex align-items-center"
            (click)="goToPage(currentPage - 1)"
          >
            <svg
              fill="currentColor"
              width="16"
              height="16"
              style="margin-right: 4px"
            >
              <use
                xlink:href="./assets/icons/bootstrap-icons.svg#chevron-left"
              />
            </svg>
            Previous
          </button>
        </li>
        <li
          class="page-item"
          *ngFor="let page of [].constructor(totalPages); let i = index"
          [class.active]="currentPage === i + 1"
        >
          <button class="page-link" (click)="goToPage(i + 1)">
            {{ i + 1 }}
          </button>
        </li>
        <li class="page-item" [class.disabled]="currentPage === totalPages">
          <button
            class="page-link d-flex align-items-center"
            (click)="goToPage(currentPage + 1)"
          >
            Next
            <svg
              fill="currentColor"
              width="16"
              height="16"
              style="margin-left: 4px"
            >
              <use
                xlink:href="./assets/icons/bootstrap-icons.svg#chevron-right"
              />
            </svg>
          </button>
        </li>
      </ul>
    </nav>
  </div>
</div>
